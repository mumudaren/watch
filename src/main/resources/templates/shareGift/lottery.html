<!DOCTYPE html>
<html>
    <head>        
        <meta charset="utf-8">
        <meta name="Description" content="幸运抽奖" />
        <title>幸运抽奖</title>       
        <meta content="yes" name="apple-mobile-web-app-capable">
        <meta content="yes" name="apple-touch-fullscreen">
        <meta name="App-Config" content="fullscreen=yes,userHistoryState,transition=yes"> 
        <meta content="telephone=no" name="format-detection">
        <link rel="stylesheet" type="text/css" href="css/gift.css" />
        <script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
        <script type="text/javascript" src="js/flexible.js"></script>
        <script type="text/javascript" src="js/flexible_css.js"></script>   
       
    </head>
    <body>  
      <div class="wrap lottery_wrap">
          <div class="f_lotterybj" id="lottery">
            <ul>
                <li class="lotter_list">iphone</li>
                <li class="lotter_list">iwatch</li>
                <li class="lotter_list">ipad</li>
                <li class="lotter_list">1000积分</li>
                <li>
                    <img src="images/giftImage/lottery_03.png">
                </li>
                <li class="lotter_list">200积分</li>
                <li class="lotter_list">20元代金券</li>
                <li class="lotter_list">1000元代金券</li>
                <li class="lotter_list">10元代金券</li>
            </ul>
          </div> 
          <div class="f_lottery_prize">
                <span>当前您有<em>200积分</em>，可抽奖<b style="font-weight: normal;">2</b>次</span>
          </div>
          <div class="f_lottery_rule">
                <p>规则说明</p>
                <p>
                    1、每次抽奖使用100积分<br />
                    2、如何获得积分，你可以分享给朋友，朋友领取后将获得10积分<br />
                    3、最终解释权归天舟通信所有
                </p>
          </div>
      </div>


      <script type="text/javascript">
                var lottery={
                    index:-1,	//当前转动到哪个位置，起点位置
                    count:0,	//总共有多少个位置
                    timer:0,	//setTimeout的ID，用clearTimeout清除
                    speed:20,	//初始转动速度
                    times:0,	//转动次数
                    cycle:50,	//转动基本次数：即至少需要转动多少次再进入抽奖环节
                    prize:-1,	//中奖位置
                    prizeName: '',  //中奖商品名称
                    init:function(id){
                        if ($("#"+id).find("ul li.lotter_list").length>0) {
                            $lottery = $("#"+id);
                            $units = $lottery.find("ul li.lotter_list");
                            //lottery div
                            this.obj = $lottery;
                            //8个
                            this.count = $units.length;
                            this.prizeName = $lottery.find("ul li.lotter_list").text();
                        }
                    },
                    roll:function(){
                        var index = this.index;
                        var count = this.count;
                        var lottery = this.obj;
                        $(lottery).find("ul li.lotter_list").eq(index).removeClass("actived");
                        index += 1;
                        if (index>count-1) {
                            index = 0;
                        }
                        $(lottery).find("ul li.lotter_list").eq(index).addClass("actived");
                        
                        this.index=index;
                        return false;
                    },
                    stop:function(index){
                        this.prize = index;
                        return false;

                    }
                };
                
                function roll(){
                    lottery.times += 1;
                    lottery.roll();
                    if (lottery.times > lottery.cycle+10 && lottery.prize==lottery.index) {
                        clearTimeout(lottery.timer);
                        lottery.prize=-1;
                        lottery.times=0;
                        click=false;
                        //显示中奖信息。
                        this.prizeName = $lottery.find("ul li.lotter_list").eq(lottery.index).text();
                        $(".f_lottery_prize").find("span em").text(this.prizeName);
                    }else{
                        //抽奖50次以内。
                        if (lottery.times<lottery.cycle) {
                            lottery.speed -= 10;
                        }else if(lottery.times==lottery.cycle) {
                            var index = Math.random()*(lottery.count)|0;
                            lottery.prize = index;
                        }else{
                            if (lottery.times > lottery.cycle+10 && ((lottery.prize==0 && lottery.index==7) || lottery.prize==lottery.index+1)) {
                                lottery.speed += 110;
                            }else{
                                lottery.speed += 20;
                            }
                        }
                        if (lottery.speed<40) {
                            lottery.speed=40;
                        }
                        lottery.timer = setTimeout(roll,lottery.speed);
                    }
                    return false;
                }
                
                var click=false;
                var clickNum = 0;    //点击次数
                var reduceNum = 2;   //点击次数的计算
                var clickNumber=2;
                window.onload=function(){
                    //初始化。
                    lottery.init('lottery');
                    //点击抽奖。
                    $("#lottery ul li:eq(4)").click(function(){
                        clickNum++;
                        if(clickNum<=clickNumber){
                            if (click) {
                                    return false;
                                }else{
                                    //转速变为100
                                    lottery.speed=100;
                                    roll();
                                    click=true;
                                    reduceNum--;                                    
                                    $(".f_lottery_prize").find("span b").text(reduceNum);
                                    return false;  
                                }
                        }else{
                            alert('抱歉，今日2次机会已用完！');
                        } 
                    });
                };
      </script>
    </body>     
</html>